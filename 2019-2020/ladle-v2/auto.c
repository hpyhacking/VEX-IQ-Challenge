#pragma config(Sensor, port4,  touchLED,      sensorVexIQ_LED)
#pragma config(Sensor, port10, gyroSensor,           sensorVexIQ_Gyro)
#pragma config(Motor,  motor1,          leftWheelMotor,     tmotorVexIQ, PIDControl, reversed, encoder)
#pragma config(Motor,  motor2,          leftLadleMotor, tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor3,          leftArmMotor,  tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor7,          rightWheelMotor,    tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor8,          rightLadleMotor, tmotorVexIQ, PIDControl, reversed, encoder)
#pragma config(Motor,  motor9,          rightArmMotor, tmotorVexIQ, PIDControl, reversed, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#define TURN_RIGHT(degress) turnAction(30, degress, 5000)
#define TURN_LEFT(degress) turnAction(-30, degress, 5000)
#define FORWARD(time) goTime(time, true)
#define BACK(time) goTime(time, false)
#define SET_WHEEL_SPEED(speed) setWheelMotorSpeed(speed)

#define ARM(degress) armAction(30, degress)
#define ARM_LOWEST ARM(0)
#define ARM_HIGHEST ARM(200)
#define ARM_UP ARM(170)
#define ARM_DOWN ARM(80)
#define DELAY(time) delay(time)

void init();
void goTime(int time, bool forwardOrBack);
void goTimeAction(int speed, int delayTime);
void turnAction(int speed, int degree, int maxTime);
void armAction(int speed, int degree);
void setWheelMotorSpeed(int speed);
void setLEDReady();
void setLEDEnding();

int wheelMotorSpeed;

//main *****************************************************************
task main()
{
	init();

	setLEDReady();

	// GREEN QUBE 20 points script
	SET_WHEEL_SPEED(20);
	FORWARD(1000);
	TURN_LEFT(20);
	BACK(500);
	TURN_RIGHT(5);
	FORWARD(900);
	ARM_UP;
	TURN_RIGHT(6);
	FORWARD(1950);
	ARM_DOWN;

	// RETURN TO BASE
	SET_WHEEL_SPEED(50);
	BACK(1600);
	ARM_LOWEST;

	// BLUE QUBE TO OTHER SIDE
	//SET_WHEEL_SPEED(30);
	//FORWARD(600);
	//TURN_LEFT(35);
	//FORWARD(1400);
	//TURN_RIGHT(27);
	//FORWARD(300);
	//ARM_HIGHEST;
	//TURN_RIGHT(5);
	//BACK(1000);
	//ARM_DOWN;

	//TURN_RIGHT(65);
	//FORWARD(3800);
	//TURN_LEFT(25);
	//FORWARD(3000);
	//ARM_LOWEST;
	//BACK(1500);
	//TURN_LEFT(35);
	//BACK(1500);
	//ARM_HIGHEST;


	setLEDReady();
	// GREEN QUBE 20 points script
	SET_WHEEL_SPEED(20);
	FORWARD(1000);
	TURN_LEFT(20);
	BACK(500);
	TURN_RIGHT(6);
	FORWARD(900);
	ARM_UP;
	TURN_RIGHT(5);
	FORWARD(1950);
	ARM_DOWN;

	//// GREEN QUBE 20 points script
	//SET_WHEEL_SPEED(20);
	//FORWARD(1000);
	//TURN_LEFT(20);
	//BACK(500);
	//TURN_RIGHT(3);
	//FORWARD(750);
	//ARM_UP;
	//TURN_RIGHT(5);
	//FORWARD(1930);
	//ARM_DOWN;

	// RETURN TO BASE
	SET_WHEEL_SPEED(50);
	BACK(1600);
	ARM_LOWEST;

	setLEDEnding();

	// HIGH GREEN QUBE 20 points script

	//FORWARD(300);
	//TURN_LEFT(40);
	//FORWARD(2500);
	//ARM_HIGHEST;
	//TURN_LEFT(10);
	//BACK(2000);
	//TURN_LEFT(40);
	//FORWARD(300);
	//DELAY(100);
	//FORWARD(300);
	//DELAY(100);
	//FORWARD(300);
	//DELAY(100);
	//FORWARD(300);
	//DELAY(100);
	//FORWARD(300);
	//DELAY(100);
	//FORWARD(300);
	//DELAY(100);
	//ARM_UP;
	//BACK(1000);
	//ARM_LOWEST;
}

void turnAction(int speed, int degree, int maxTime)
{
	int realDegree = 0;
	clearTimer(T1);
	resetGyro(gyroSensor);

	realDegree = abs(getGyroHeading(gyroSensor));
	setMotorSpeed(leftWheelMotor, speed);
	setMotorSpeed(rightWheelMotor, -speed);

	while(realDegree < degree)
	{
		realDegree = abs(getGyroHeading(gyroSensor));
		displayTextLine(2, "%d", realDegree);

		if(time1[T1] > maxTime)
		{
			playNote(noteCSharp, octave2,  200);
			break;
		}
	}

	setMotorSpeed(leftWheelMotor,  0);
	setMotorSpeed(rightWheelMotor, 0);
	delay(100);
}

void goTime(int time, bool forwardOrBack)
{
	if (forwardOrBack)
	{
		goTimeAction(wheelMotorSpeed, time);
	}
	else
	{
		goTimeAction(0 - wheelMotorSpeed, time);
	}

}

void goTimeAction(int speed, int delayTime)
{
	int tempSpeed;
	int tempDelay;

	int i;

	int leftSpeed, rightSpeed;

	tempSpeed = speed / 5;
	tempDelay = delayTime / 50;

	for(i = 1; i <= 5; i++)
	{
		leftSpeed = tempSpeed * i;
		rightSpeed = leftSpeed;

		setMotorSpeed(leftWheelMotor, leftSpeed);
		setMotorSpeed(rightWheelMotor, rightSpeed);
		delay(5);
	}

	delay(delayTime - 50);

	for(i = 5; i >= 1; i--)
	{
		leftSpeed = tempSpeed * i;
		rightSpeed = leftSpeed;
		setMotorSpeed(leftWheelMotor, leftSpeed);
		setMotorSpeed(rightWheelMotor, rightSpeed);
		delay(5);
	}

	setMotorSpeed(leftWheelMotor, 0);
	setMotorSpeed(rightWheelMotor, 0);
	delay(20);
}


void armAction(int speed, int degree)
{
	setMotorTarget(leftArmMotor, degree, speed);
	setMotorTarget(rightArmMotor, degree, speed);
	waitUntilMotorStop(leftArmMotor);
	waitUntilMotorStop(rightArmMotor);
	//resetMotorEncoder(leftArmMotor);
	//resetMotorEncoder(rightArmMotor);
}

void setWheelMotorSpeed(int speed) {
	wheelMotorSpeed = speed;
}

void setLEDReady()
{
	setTouchLEDColor(touchLED, colorBlueGreen);     // set touch LED color as Red
	waitUntil((getTouchLEDValue(touchLED) == 1)); // wait touch
	setTouchLEDColor(touchLED, colorOrange);   // when touch LED, its color change to Green
}

void setLEDEnding()
{
	setTouchLEDColor(touchLED, colorGreen);     // set touch LED color as Red
}

void init()
{

	resetMotorEncoder(leftArmMotor);
	resetMotorEncoder(rightArmMotor);
	resetMotorEncoder(rightWheelMotor);
	resetMotorEncoder(leftWheelMotor);
	resetMotorEncoder(leftLadleMotor);
	resetMotorEncoder(rightLadleMotor);
}
